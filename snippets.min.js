var all_tags=[],URL="https://spreadsheets.google.com/feeds/list/"+getSheetId()+"/od6/public/values?alt=json";init();
function init(){$(".timeline").empty();$(".snippet-tag-link").remove();"true"==getUrlParam("post")&&$("#new-snippet-container").show();$.getJSON(URL,function(a){$("#loading-snippet").remove();a=a.feed.entry;a.reverse();$(".snippet-counter").html(a.length+" snippets found");$.each(a,function(a,c){var b=createSnippet(c.gsx$title.$t,c.gsx$title.$t.toLowerCase().replace(/[^a-zA-Z0-9 ]/g,"").replace(/[ ]/g,"_"),micromarkdown.parse(c.gsx$content.$t),micromarkdown.parse(c.gsx$meta.$t),c.gsx$tags.$t),d=b.tags.split(",").map(function(a){return a.trim()});
all_tags=all_tags.concat(d);b=createSnippetHTML(b.title,b.id,b.content,b.meta,b.tags);$(".timeline").append(b)});new ClipboardJS(".copy-btn");renderAllTags()})}function getSheetId(){var a=document.getElementsByTagName("script");if(a=a[a.length-1].getAttribute("data-id"))return a;console.log("No sheet ID present!")}
function newSnippet(){snippet={title:$("#new-snippet-title").val(),content:$("#new-snippet-content").val(),meta:$("#new-snippet-meta").val(),tags:$("#new-snippet-tags").val(),token:$("#new-snippet-token").val()};"AQW"==snippet.token&&$.post("https://hooks.zapier.com/hooks/catch/2756301/q80edt/",snippet,function(a,b){console.log("Data: "+a+"\nStatus: "+b)})}
function showAllTags(){$(".page-tags").empty();$(".page-tags").append("<button class='snippet-tag-link' onclick='filterOnTag(\"all\")'>all</button>");$.each(all_tags,function(a,b){$(".page-tags").append("<button class='snippet-tag-link' onclick='filterOnTag(\""+b+"\")'>"+b+"</button>")})}
function filterOnTag(a){"all"==a?init():($(".timeline").html(createSnippetHTML("Loading...","loading","Fetching snippets...","...","...")),$.getJSON(URL,function(b){$(".timeline").empty();var c=0;$.each(b.feed.entry,function(b,d){if(d.gsx$tags.$t.includes(a)){c+=1;var e=createSnippet(d.gsx$title.$t,d.gsx$title.$t.toLowerCase().replace(/[^a-zA-Z0-9 ]/g,"").replace(/[ ]/g,"_"),micromarkdown.parse(d.gsx$content.$t),micromarkdown.parse(d.gsx$meta.$t),d.gsx$tags.$t);e=createSnippetHTML(e.title,e.id,e.content,
e.meta,e.tags);$(".snippet-counter").html(c+" snippets found");$(".timeline").append(e)}})}))}function getUrlParam(a,b){b||(b=location.href);a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var c=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(b);return null==c?null:c[1]}function createSnippet(a,b,c,f,d){return{title:a,id:b,content:c,meta:f,tags:d}}
function createSnippetHTML(a,b,c,f,d){try{var e=d.split(",").map(function(a){return a.trim()})}catch(k){e=d}var g="",h="";$.each(e,function(a,b){g+='<span class="snippet-tags float-right">'+b+"</span>";h+=b+" "});return'<li id="'+b+'" class="snippet-li '+h+'">\n        <span class="snippet-title">'+a+"</span>\n         "+g+'\n        <div class="snippet-content">'+c+'</div>\n        <div class="snippet-footer">'+f+'\n        <button class="float-right copy-btn"  data-clipboard-action="copy" data-clipboard-target="#'+
b+' .snippet-content">copy</button></div></li>'}function renderAllTags(){all_tags=all_tags.filter(function(a,b,c){return c.indexOf(a)===b});all_tags.sort();$.each(all_tags,function(a,b){10>a&&$(".page-tags").append("<button class='snippet-tag-link' onclick='filterOnTag(\""+b+"\")'>"+b+"</button>");10==a&&$(".page-tags").append("<button class='snippet-tag-link' onclick='showAllTags()'>more ...</button>")})};